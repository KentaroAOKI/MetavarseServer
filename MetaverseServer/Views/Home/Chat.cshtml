@{
    ViewBag.Title = "Metaverse Chat";
}
<h2>Metaverse Chat</h2>
<div class="containerJoin">
    <input type="text" id="vrmUrl" />
    <input type="button" id="join" value="Join" />
    <input type="hidden" id="userName" />
</div>
<div class="containerMessage">
    <input type="text" id="message" />
    <input type="button" id="sendMessage" value="SetMessage" />
    <input type="hidden" id="userName" />
</div>
<div class="containerPosition">
    <input type="text" id="positionX" />
    <input type="text" id="positionY" />
    <input type="text" id="positionZ" />
    <input type="button" id="sendPosition" value="SetPosition" />
    <input type="hidden" id="userName" />
</div>
<div class="containerDiscussion">
    <ul id="discussion">
    </ul>
</div>
@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display environment.
            chat.client.setEnvironment = function (environment) {
                // Add the message to the page.
                $('#discussion').append('<li><strong>setEnvironment: '
                    + '</strong>: ' + environment + '</li>');
            };
            // Create a function that the hub can call back to display messages.
            chat.client.setMessage = function (cid, message) {
                // Add the message to the page.
                $('#discussion').append('<li><strong>setMessage: ' + htmlEncode(cid)
                    + '</strong>: ' + htmlEncode(message) + '</li>');
            };
            // Create a function that the hub can call back to display position.
            chat.client.setPosition = function (cid, x, y, z) {
                // Add the message to the page.
                $('#discussion').append('<li><strong>setPosition: ' + htmlEncode(cid)
                    + '</strong>: ' + htmlEncode(x) + ', ' + htmlEncode(y) + ', ' + htmlEncode(z) + '</li>');
            };
            chat.client.spawnAvater = function (cid, userName, vrmUrl, x, y, z) {
                // Add the message to the page.
                $('#discussion').append('<li><strong>spawnAvater: ' + htmlEncode(cid)
                    + '</strong>: ' + htmlEncode(userName) + ', '  + htmlEncode(vrmUrl) + ', ' + htmlEncode(x) + ', ' + htmlEncode(y) + ', ' + htmlEncode(z) + '</li>');
            }
            chat.client.destoryAvater = function (cid) {
                // Add the message to the page.
                $('#discussion').append('<li><strong>destoryAvater: ' + htmlEncode(cid) + '</li>');
            }
            // Get the user name and store it to prepend to messages.
            $('#userName').val(prompt('Enter your user name:', ''));
            // Set initial data.
            $('#vrmUrl').val('https://');
            $('#message').val('');
            $('#message').focus();
            $('#positionX').val((Math.random() * 10.0) - 5.0);
            $('#positionY').val(Math.random() * 10.0);
            $('#positionZ').val((Math.random() * 10.0) - 5.0);
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#join').click(function () {
                    // Call the Send method on the hub.
                    chat.server.join($('#userName').val(), $('#vrmUrl').val());
                });
                $('#sendMessage').click(function () {
                    // Call the Send method on the hub.
                    chat.server.setMessage($('#message').val());
                    // Initialize text box.
                    $('#message').val('');
                    $('#message').focus();
                });
                $('#sendPosition').click(function () {
                    // Call the Send method on the hub.
                    chat.server.setPosition($('#positionX').val(), $('#positionY').val(), $('#positionZ').val());
                    // Initialize text box.
                    $('#positionX').val((Math.random() * 10.0) - 5.0);
                    $('#positionY').val(Math.random() * 10.0);
                    $('#positionZ').val((Math.random() * 10.0) - 5.0);
                    $('#sendPosition').focus();
                });
            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
    </script>
}